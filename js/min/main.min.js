"use strict;";function Notion(){let _instance,_RenderingHelper,_FirebaseHelper;function init(){_RenderingHelper=new RenderingHelper,_FirebaseHelper=new FirebaseHelper;let promise=new Promise(function(resolve,reject){_FirebaseHelper.isUserLoggedIn(resolve,reject)});promise.then(function(firebaseUser){loadApp(firebaseUser,!0)}),promise.catch(firebaseUserStatusNoUser)}function firebaseUserStatusNoUser(){const blankUser={email:""};loadApp(blankUser,!1)}function loadApp(user,isLoggedIn){new Vue({el:"#app",data:{currentPage:{title:"",text:""},pageTitle:"",pageLastEditedUser:"",pageLastEditedDate:"",editorContent:"",alertMessage:"",user:user,userEmail:user.email,userPassword:"",isLoggedIn:isLoggedIn,isMenuShown:!1},firebase:{pages:{source:_FirebaseHelper.getReference(ObjectType.Page),readyCallback:function(){this.pages.length>0&&(this.showContent(this.pages[0]),this.setFocusOnPreview())}}},computed:{compiledMarkdown:function(){return _RenderingHelper.renderPreview(this.editorContent)},pageLastEditedDateComputed:function(){return 0===this.pageLastEditedDate.length?null:new Date(this.pageLastEditedDate).toLocaleDateString("fr-FR")}},methods:{addPage:function(){!1!==this.isLoggedIn&&(this.editorContent=this._defaultPageContent(),this.pageTitle=this._defaultPageTitle(),this.currentPage={title:this.pageTitle,text:this.editorContent,date:new Date,user:this.userEmail},this.currentPage[".key"]=_FirebaseHelper.add(ObjectType.Page,this.currentPage))},savePage:function(page){if(!1!==this.isLoggedIn){0===this.pageTitle.length&&(this.pageTitle=this._defaultPageTitle());var newValues={title:this.pageTitle,text:this.editorContent,date:new Date,user:this.user.email};_FirebaseHelper.save(ObjectType.Page,page[".key"],newValues),this.addAlert("Sauvegard√© le "+this._defaultPageTitle())}},removePage:function(page){!1!==this.isLoggedIn&&_FirebaseHelper.remove(ObjectType.Page,page[".key"])},showPageMenu:function(page){!1!==this.isLoggedIn&&(this.isMenuShown=!this.isMenuShown,!0===this.isMenuShown?_RenderingHelper.setFocus(FocusType.Menu):_RenderingHelper.setFocus(FocusType.Preview))},showContent:function(page){this.currentPage=page,this.editorContent=page.text,this.pageTitle=page.title,this.pageLastEditedUser=page.user,this.pageLastEditedDate=page.date},updatePreview:_.debounce(function(e){this.editorContent=e.target.value},300),setFocusOnEditor:function(element){this.isMenuShown=!1,_RenderingHelper.setFocus(FocusType.Editor)},setFocusOnPreview:function(element){this.isMenuShown=!1,_RenderingHelper.setFocus(FocusType.Preview)},login:function(){let instance=this,promise=_FirebaseHelper.signIn(this.userEmail,this.userPassword);promise.then(function(){instance.isLoggedIn=!0}),promise.catch(function(error){instance.isLoggedIn=!1,instance.addAlert(error.message)})},logout:function(){let instance=this,promise=_FirebaseHelper.signOut();promise.then(function(){instance.isLoggedIn=!1}),promise.catch(function(error){instance.addAlert(error.message)})},addAlert:function(text){this.alertMessage=text},_defaultPageContent:function(){const date=new Date;return"*"+date.toLocaleDateString("fr-FR")+"*\n___"},_defaultPageTitle:function(){const date=new Date;return date.getHours()+":"+date.getMinutes()+":"+date.getSeconds()}}})}(Notion=function(){return _instance}).prototype=this,(_instance=new Notion).constructor=Notion,init()}new Notion;