"use strict";function Notion(){let _instance,_RenderingHelper,_FirebaseHelper;function init(){_RenderingHelper=new RenderingHelper,_FirebaseHelper=new FirebaseHelper;let promise=new Promise(function(resolve,reject){_FirebaseHelper.isUserLoggedIn(resolve,reject)});promise.then(function(firebaseUser){loadApp(firebaseUser,!0)}),promise.catch(firebaseUserStatusNoUser)}function firebaseUserStatusNoUser(){const blankUser={email:"",password:""};loadApp(blankUser,!1)}function loadApp(user,isLoggedIn){new Vue({el:"#app",data:{currentPage:{content:""},alertMessage:"",user:user,isLoggedIn:isLoggedIn,isMenuShown:!1,email:user.email,password:""},firebase:{pages:{source:_FirebaseHelper.getReference(ObjectType.Page),readyCallback:function(){this.pages.length>0&&(this.showContent(this.pages[0]),this.setFocusOnPreview())}}},computed:{compiledMarkdown:function(){return _RenderingHelper.renderPreview(this.currentPage.content)},pageLastEditedDateComputed:function(){return Tool.isUndefinedOrNullOrEmpty(this.currentPage.dtModified)?null:DateHelper.getDateString(this.pageLastEditedDate)}},methods:{addPage:function(){if(!1===this.isLoggedIn)return;const newPage=new Page(Page.getDefaultTitle(),Page.getDefaultContent(),this.user.email,new Date,null);this.currentPage=_FirebaseHelper.add(ObjectType.Page,newPage)},savePage:function(currentPage){if(!1===this.isLoggedIn)return;const page=new Page(this.currentPage.title,this.currentPage.content,this.user.email,new Date,currentPage._id);_FirebaseHelper.save(ObjectType.Page,page.id,page),this.addAlert(`${Resx.savedAt} ${DateHelper.getTimeString()}`)},removePage:function(currentPage){!1!==this.isLoggedIn&&_FirebaseHelper.remove(ObjectType.Page,currentPage._id)},showPageMenu:function(currentPage){!1!==this.isLoggedIn&&(this.isMenuShown=!this.isMenuShown,!0===this.isMenuShown?_RenderingHelper.setFocus(FocusType.Menu):_RenderingHelper.setFocus(FocusType.Preview))},showContent:function(p){const page=new Page(p._title,p._content,p._userModifiedBy,p._dtModified,p._id);this.currentPage=page},updatePreview:_.debounce(function(e){this.currentPage.content=e.target.value},300),setFocusOnEditor:function(element){this.isMenuShown=!1,_RenderingHelper.setFocus(FocusType.Editor)},setFocusOnPreview:function(element){this.isMenuShown=!1,_RenderingHelper.setFocus(FocusType.Preview)},login:function(){let instance=this,promise=_FirebaseHelper.signIn(this.email,this.password);promise.then(function(){instance.isLoggedIn=!0}),promise.catch(function(error){instance.isLoggedIn=!1,instance.addAlert(error.message)})},logout:function(){let instance=this,promise=_FirebaseHelper.signOut();promise.then(function(){instance.isLoggedIn=!1}),promise.catch(function(error){instance.addAlert(error.message)})},addAlert:function(text){this.alertMessage=text}}})}(Notion=function(){return _instance}).prototype=this,(_instance=new Notion).constructor=Notion,init()}new Notion;