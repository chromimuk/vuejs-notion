function App(){var isInitialized=!1,g_RenderingHelper=RenderingHelper(),g_FirebaseHelper=FirebaseHelper();function init(){g_FirebaseHelper.init(),firebase.auth().onAuthStateChanged(firebaseUser=>{!1===isInitialized&&(firebaseUser?(load(firebaseUser,!0),isInitialized=!0):(load({email:""},!1),isInitialized=!0))})}function load(user,isLoggedIn){var g_PageRepo=FirebasePageReference();g_PageRepo.init();var app=new Vue({el:"#app",data:{currentPage:{title:"",text:""},pageTitle:"",pageLastEditedUser:"",pageLastEditedDate:"",editorContent:"",alertMessage:"",user:user,userEmail:user.email,userPassword:"",isLoggedIn:isLoggedIn,isMenuShown:!1},firebase:{pages:{source:g_PageRepo.getReference(),readyCallback:function(){this.pages.length>0&&(this.showContent(this.pages[0]),this.setFocusOnPreview())}}},computed:{compiledMarkdown:function(){return g_RenderingHelper.renderPreview(this.editorContent)},pageLastEditedDateComputed:function(){return 0===this.pageLastEditedDate.length?null:new Date(this.pageLastEditedDate).toLocaleDateString("fr-FR")}},methods:{addPage:function(){!1!==this.isLoggedIn&&(this.editorContent=this._defaultPageContent(),this.pageTitle=this._defaultPageTitle(),this.currentPage={title:this.pageTitle,text:this.editorContent,date:new Date,user:this.userEmail},this.currentPage[".key"]=g_PageRepo.add(this.currentPage))},savePage:function(page){if(!1!==this.isLoggedIn){0===this.pageTitle.length&&(this.pageTitle=this._defaultPageTitle());var newValues={title:this.pageTitle,text:this.editorContent,date:new Date,user:this.user.email};g_PageRepo.save(page[".key"],newValues),this.addAlert("Sauvegard√© le "+this._defaultPageTitle())}},removePage:function(page){!1!==this.isLoggedIn&&g_PageRepo.remove(page[".key"])},showPageMenu:function(page){!1!==this.isLoggedIn&&(this.isMenuShown=!this.isMenuShown,!0===this.isMenuShown?g_RenderingHelper.setFocus(FocusType.Menu):g_RenderingHelper.setFocus(FocusType.Preview))},showContent:function(page){this.currentPage=page,this.editorContent=page.text,this.pageTitle=page.title,this.pageLastEditedUser=page.user,this.pageLastEditedDate=page.date},updatePreview:_.debounce(function(e){this.editorContent=e.target.value},300),setFocusOnEditor:function(element){this.isMenuShown=!1,g_RenderingHelper.setFocus(FocusType.Editor)},setFocusOnPreview:function(element){this.isMenuShown=!1,g_RenderingHelper.setFocus(FocusType.Preview)},login:function(){var instance=this,promise=g_FirebaseHelper.signIn(this.userEmail,this.userPassword);promise.then(function(firebaseUser){instance.isLoggedIn=!0}),promise.catch(function(error){instance.isLoggedIn=!1,instance.addAlert(error.message)})},logout:function(){var instance=this,promise=g_FirebaseHelper.signOut();promise.then(function(){instance.isLoggedIn=!1}),promise.catch(function(error){instance.addAlert(error.message)})},addAlert:function(text){this.alertMessage=text},_defaultPageContent:function(){var date;return"*"+(new Date).toLocaleDateString("fr-FR")+"*\n___"},_defaultPageTitle:function(){var date=new Date;return date.getHours()+":"+date.getMinutes()+":"+date.getSeconds()}}})}return{init:init}}App().init();