"use strict;";function Notion(){let _instance,_RenderingHelper,_FirebaseHelper;function init(){_RenderingHelper=new RenderingHelper,_FirebaseHelper=new FirebaseHelper;let promise=new Promise(function(resolve,reject){_FirebaseHelper.isUserLoggedIn(resolve,reject)});promise.then(function(firebaseUser){loadApp(firebaseUser,!0)}),promise.catch(firebaseUserStatusNoUser)}function firebaseUserStatusNoUser(){const blankUser={email:""};loadApp(blankUser,!1)}function loadApp(user,isLoggedIn){new Vue({el:"#app",data:{currentPage:{title:"",text:""},pageTitle:"",pageLastEditedUser:"",pageLastEditedDate:"",editorContent:"",alertMessage:"",user:user,userEmail:user.email,userPassword:"",isLoggedIn:isLoggedIn,isMenuShown:!1},firebase:{pages:{source:_FirebaseHelper.getReference(ObjectType.Page),readyCallback:function(){this.pages.length>0&&(this.showContent(this.pages[0]),this.setFocusOnPreview())}}},computed:{compiledMarkdown:function(){return _RenderingHelper.renderPreview(this.editorContent)},pageLastEditedDateComputed:function(){return this.isUndefinedOrNullOrEmpty(this.pageLastEditedDate)?null:new Date(this.pageLastEditedDate).toLocaleDateString("fr-FR")}},methods:{addPage:function(){if(!1===this.isLoggedIn)return;this.editorContent=Page.getDefaultContent(),this.pageTitle=Page.getDefaultTitle();const newPage=new Page(this.pageTitle,this.editorContent,this.userEmail,new Date,null);this.currentPage=_FirebaseHelper.add(ObjectType.Page,newPage)},savePage:function(currentPage){if(!1===this.isLoggedIn)return;const page=new Page(this.pageTitle,this.editorContent,this.userEmail,new Date,currentPage._id);_FirebaseHelper.save(ObjectType.Page,page.id,page),this.addAlert("Sauvegard√© le "+new Date)},removePage:function(currentPage){!1!==this.isLoggedIn&&_FirebaseHelper.remove(ObjectType.Page,currentPage._id)},showPageMenu:function(currentPage){!1!==this.isLoggedIn&&(this.isMenuShown=!this.isMenuShown,!0===this.isMenuShown?_RenderingHelper.setFocus(FocusType.Menu):_RenderingHelper.setFocus(FocusType.Preview))},showContent:function(p){const page=new Page(p._title,p._content,p._userModifiedBy,p._dtModified,p._id);this.currentPage=page,this.pageTitle=page._title,this.editorContent=page._content,this.pageLastEditedUser=page._userModifiedBy,this.pageLastEditedDate=page._dtModified},updatePreview:_.debounce(function(e){this.editorContent=e.target.value},300),setFocusOnEditor:function(element){this.isMenuShown=!1,_RenderingHelper.setFocus(FocusType.Editor)},setFocusOnPreview:function(element){this.isMenuShown=!1,_RenderingHelper.setFocus(FocusType.Preview)},login:function(){let instance=this,promise=_FirebaseHelper.signIn(this.userEmail,this.userPassword);promise.then(function(){instance.isLoggedIn=!0}),promise.catch(function(error){instance.isLoggedIn=!1,instance.addAlert(error.message)})},logout:function(){let instance=this,promise=_FirebaseHelper.signOut();promise.then(function(){instance.isLoggedIn=!1}),promise.catch(function(error){instance.addAlert(error.message)})},addAlert:function(text){this.alertMessage=text},isUndefinedOrNullOrEmpty:function(element){return void 0===element||null===element||0===element.length}}})}(Notion=function(){return _instance}).prototype=this,(_instance=new Notion).constructor=Notion,init()}new Notion;